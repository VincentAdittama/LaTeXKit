# MISSION: CONVERT (Phase 6 of 6)

## VISION
Transmute the Markdown draft into professional LaTeX source files, enforcing the final document language and formatting rules.

## CONTEXT
- **Input**: `draft.md` and partial `latex_source`.
- **Output**: Populated `latex_source/*.tex`, `main.tex` metadata.
- **Goal**: Compile-ready LaTeX.

## INPUT
```text
$ARGUMENTS
```

## MISSION STEPS

1.  **DETECT & SETUP**
    - Execute `PROJECT_ROOT="$(git rev-parse --show-toplevel)" && bash "$PROJECT_ROOT/.latexkit/scripts/bash/check_state.sh"`
    - Import LaTeX template from `registry/` to `$PROJECT_ROOT/documents/$ACTIVE_PROJECT/latex_source` if empty.
    - **University Config**:
        - **CHECK** `main.tex` for existing variable definitions (`\docUniversity`, `\docFaculty`, etc.).
        - **DO NOT** create `university-info.tex` or any external config files.
        - **Action**: Ensure the variables in `main.tex` are preserved. If they are missing, alert the user, but do not overwrite them with defaults if they seem populated.
    - **Language**: Read `generated_work/plan.md` for "Document Output Language".
        - If `Indonesian`: ALL output must be Indonesian.
        - If `English`: ALL output must be English.
        - **Translate** content if draft language != output language.

2.  **GENERATE METADATA**
    - Read `generated_work/plan.md` and `assignment_info/*.md` for metadata.
    - **Update `main.tex`**:
        - `\newcommand{\docTitle}{...}` -> Fill with Project Title.
        - `\newcommand{\docCourse}{...}` -> Fill with Course Name.
        - `\newcommand{\docAuthor}{...}` -> Fill with Student Name (if unknown use "[Student Name]").
        - `\newcommand{\docNIM}{...}` -> Fill with Student ID (if unknown use "[NIM]").
        - `\newcommand{\docProfessor}{...}` -> Fill with Lecturer Name.
        - `\newcommand{\docDate}{...}` -> Fill with Deadline or `\today`.


3.  **EXECUTE: Conversion (MD -> LaTeX)**
    - Split draft into `sections/01_introduction.tex`, `sections/02_body.tex`, etc.
    - **Formatting**:
        - `**bold**` -> `\textbf{bold}` (Check for ChatGPT `<TAB>extbf` bug).
        - `\cite{key}` -> `\cite{key}`.
        - Headings -> `\section{}`, `\subsection{}`.
    - **Escaping**: Verify no unescaped `&`, `%`, `_`.

4.  **CONFIGURE BIBLIOGRAPHY**
    - **Convention Enforced**: The bibliography file MUST be named `Exported Items.bib`.
    - Check `zotero_export/` for `Exported Items.bib`.
    - **Action**:
        - If `Exported Items.bib` exists: Ensure `latex_source/preamble.tex` has `\addbibresource{../zotero_export/Exported Items.bib}`.
        - If ONLY other .bib files exist (e.g. `refs.bib`): WRONG CONVENTION. Use the existing file temporarily but **WARN THE USER** to rename it to `Exported Items.bib`.
        - If NO .bib file: Do nothing, but warn missing bibliography.

5.  **REPORT**
    - Report: Files created, language status, warnings.
    - Next: "Recommended: \`latexkit build\`".

## RULES
- **FORBIDDEN COMMANDS**: NEVER run `xelatex`, `pdflatex`, `latex`, `bibtex`, or `biber`. The user has a separate build script.
- **Language Strictness**: The `plan.md` output language setting is absolute.
- **LaTeX Safety**: No Markdown syntax in .tex files. Check backslashes.
- **Structure**: Keep `main.tex` clean, use `\input{sections/...}`.
